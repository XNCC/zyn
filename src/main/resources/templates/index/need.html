<!DOCTYPE html>

<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <title>首页 - </title>
    <link rel="icon" href="/static/index/favicon.ico" type="image/ico">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-latest.js"></script>
    <script src="https://libs.baidu.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <link href="https://libs.baidu.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet"/>

    <script src="/static/layui/layui.js" src1="https://local.res.layui.com/layui/release/laydate/dist/laydate.js" ></script>
    <link rel=stylesheet href="/static/layui/css/layui.css">

    <link rel=stylesheet href="/static/index/need.css">
    <link rel=stylesheet href="/static/index/common.css">
</head>
<body style="background-color: rgb(244, 244, 244);">
<!-- 主页面内容 -->
<div class="layui-container">
    <div class="layui-card">
        <div class="layui-card-header" style="text-align: center;"><strong>发布任务</strong></div>
        <div class="layui-card-body">
            <div class="row">
                <div class="layui-col-md9  layui-col-xs9">
                    <div class="layui-card">
                        <div class="layui-card-body">
                            <form class="layui-form layui-form-pane1" lay-filter="first" style="">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">选择框</label>
                                    <div class="layui-input-block in">
                                        <select id="classify" name="classify" lay-filter="interest">
                                            <option value="0">脚本</option>
                                            <option value="1">web</option>
                                            <option value="2">游戏</option>
                                            <option value="3">爬虫</option>
                                            <option value="4">其他</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">标题</label><span style="color:red">*</span>
                                    <div class="layui-input-block in">
                                        <input type="text" name="title" id="title" lay-verify="required" lay-verType="tips"
                                               required
                                               class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">需求详情</label><span style="color:red">*</span>
                                    <div class="layui-input-block">
                                         <textarea name="comment" id="demo" class="layui-hide">
                                    </textarea>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">上传附件</label>
                                    <div class="layui-input-block">
                                        <div class="layui-upload">
                                            <button type="button" class="layui-btn layui-btn-normal" id="testList">选择图片
                                            </button>
                                            <div class="layui-upload-list">
                                                <table class="layui-table">
                                                    <thead>
                                                    <tr>
                                                        <th>文件名</th>
                                                        <th>大小</th>
                                                        <th>状态</th>
                                                        <th>操作</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody id="demoList"></tbody>
                                                </table>
                                                <div style="text-align: right">
                                                    <button type="button" class="layui-btn layui-btn-normal" id="upload">
                                                        上传
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">预算金额</label><span style="color:red">*</span>
                                    <div class="layui-input-block in">
                                        <input type="text" name="money" id="money" required lay-verify="required|number|Ndouble"
                                               lay-verType="tips" class="layui-input">元
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">截至日期</label><span style="color:red">*</span>
                                    <div class="layui-input-block in">
                                        <input type="text" name="deadline" lay-verify="required" required class="layui-input"
                                               id="test2">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">手机号</label><span style="color:red">*</span>
                                    <div class="layui-input-block in">
                                        <input type="tel" name="phone" id="phone" lay-verify="required|phone|number" required
                                               lay-verType="tips" class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">微信号</label>
                                    <div class="layui-input-block in">
                                        <input type="tel" name="wechat" id="wechat" lay-verType="tips" autocomplete="off"
                                               class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <div class="layui-input-block" style="text-align: center;">
                                        <button class="layui-btn" id="draft">草稿</button>
                                        <button class="layui-btn" id="submit">提交</button>
                                        <button type="button" class="btn btn-primary" id="testListAction1"
                                                style="display:none">
                                        </button>
                                    </div>
                                </div>

                            </form>

                        </div>
                    </div>
                </div>

                <div class="layui-col-md2 layui-col-xs2" style="margin-left: 15px; width: 20%;">
                    <div class="layui-card">
                        <div class="layui-card-header"><strong>本站承诺</strong></div>
                        <div class="layui-card-body">
                            零交稿零投标，任务全额退款。
                            参加悬赏任务，实名认证。
                            验收满意，再确认付款。
                        </div>
                    </div>
                    <div class="layui-card">
                        <div class="layui-card-header"><strong>任务执行流程</strong></div>
                        <div class="layui-card-body">
                            <ul class="layui-timeline">
                                <li class="layui-timeline-item">
                                    <i class="layui-icon layui-timeline-axis"></i>
                                    <div class="layui-timeline-content layui-text">
                                        <div class="layui-timeline-title">发布任务</div>
                                    </div>
                                </li>
                                <li class="layui-timeline-item">
                                    <i class="layui-icon layui-timeline-axis"></i>
                                    <div class="layui-timeline-content layui-text">
                                        <div class="layui-timeline-title">接受订单</div>
                                    </div>
                                </li>
                                <li class="layui-timeline-item">
                                    <i class="layui-icon layui-timeline-axis"></i>
                                    <div class="layui-timeline-content layui-text">
                                        <div class="layui-timeline-title">完成订单</div>
                                    </div>
                                </li>
                                <li class="layui-timeline-item">
                                    <i class="layui-icon layui-timeline-axis"></i>
                                    <div class="layui-timeline-content layui-text">
                                        <div class="layui-timeline-title">交付订单</div>
                                    </div>
                                </li>
                                <li class="layui-timeline-item">
                                    <i class="layui-icon layui-timeline-axis"></i>
                                    <div class="layui-timeline-content layui-text">
                                        <div class="layui-timeline-title">结算订单</div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="layui-card">
                        <div class="layui-card-header"><strong>协助电话</strong></div>
                        <div class="layui-card-body">
                            18154183997
                        </div>
                    </div>
                    <div class="layui-card">
                        <div class="layui-card-header"><strong>微信服务</strong></div>
                        <div class="layui-card-body">
                            <img src="/static/img/微信.jpg" style="width: 90%;">
                        </div>
                    </div>
                    <div class="layui-card">
                        <div class="layui-card-header"><strong>QQ服务</strong></div>
                        <div class="layui-card-body">
                            <img src="/static/img/微信.jpg" style="width: 90%;">
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>

</div>
<!--主页面内容  -->
<div style="text-align:center;padding-top:2%; font:normal 14px/24px 'MicroSoft YaHei';background-color: rgb(226, 226, 226);">
    <p>发布，接单变的更容易</p>
    <p>易接单平台<a href="#" target="_blank"></a></p>
</div>
</body>
<script src="/static/layui/layui.js"></script>
<script>
    var returnUrl = "";
    window.onload = function () {
        $(document).height($(".left-side-menu1").height($(document).height()))
        $("body").height($(document).height()-100)
        $(".layui-tab-title").css("border-bottom-width", "0px");
    }
    layui.use(['element', 'layedit', 'laydate', 'form'], function () {
        var element = layui.element;
        var form = layui.form;

        //tab页
        element.on('tab(test)', function (data) {
            console.log(this, data);
        });

        //编辑器
        var layedit = layui.layedit;
        var index = layedit.build('demo', {
            hideTool: ['image'],
            uploadImage: {
                url: 'json/upload/demoLayEdit.json'
                , type: 'get'
            }
            , height: 500
        });
        form.verify({
            Ndouble: [
                /^[1-9]\d*$/
                , '只能输入整数哦'
            ]
        });


        $("#submit").click(function () {
            var classify = $("#classify").val()
            var title = $("#title").val()
            var money = $("#money").val()
            var deadline = $("#test2").val()
            var phone = $("#phone").val()
            var wechat = $("#wechat").val()
            var comment = layedit.getContent(index)
            var rurl = "";
            for (var i = 0; i < $("#demoList tr").size(); i++) {
                if (rurl.length == 0) {
                    rurl = $($("#demoList tr")[i]).find("td").eq(2).attr("returnUrl")
                } else {
                    rurl = rurl + "," + $($("#demoList tr")[i]).find("td").eq(2).attr("returnUrl")
                }
            }
            $.ajax({
                type: 'POST',
                url: "/need/save",
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    "classify": classify,
                    "title": title,
                    "money": money,
                    "deadline": deadline,
                    "phone": phone,
                    "wechat": wechat,
                    "comment": comment,
                    "url": rurl
                }),
                success: function () {
                    alert("保存成功")
                },
                error: function () {
                    alert("失败")
                }
            })
            return false
        })
        $("#draft").click(function () {
            var classify = $("#classify").val()
            var title = $("#title").val()
            var money = $("#money").val()
            var deadline = $("#test2").val()
            var phone = $("#phone").val()
            var wechat = $("#wechat").val()
            var comment = layedit.getContent(index)
            var rurl = "";
            for (var i = 0; i < $("#demoList tr").size(); i++) {
                if (rurl.length == 0) {
                    rurl = $($("#demoList tr")[i]).find("td").eq(2).attr("returnUrl")
                } else {
                    rurl = rurl + "," + $($("#demoList tr")[i]).find("td").eq(2).attr("returnUrl")
                }
            }
            $.ajax({
                type: 'POST',
                url: "/need/draft",
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({
                    "classify": classify,
                    "title": title,
                    "money": money,
                    "deadline": deadline,
                    "phone": phone,
                    "wechat": wechat,
                    "comment": comment,
                    "url": rurl
                }),
                success: function () {
                    alert("保存成功")
                },
                error: function () {
                    alert("失败")
                }
            })
            return false
        })

    });

    layui.use('laydate', function (laydate) {
        //日期编辑框
        laydate.render({
            elem: '#test3'
            , format: 'yyyy-MM-dd'
            , ready: function (date) {
                console.log(date);
            }
            , done: function (value, date, endDate) {
                console.log(value, date, endDate);
            }
            , change: function (value) {
                console.log(value);
            }
        });

    });

    layui.use('upload', function () {
        var $ = layui.jquery, upload = layui.upload;
        var demoListView = $('#demoList')
        uploadListIns = upload.render({
            elem: '#testList'
            , url: '/need/upload'
            , accept: 'file'
            , acceptMime: 'image/*,video/*,txt/*,doc/*,docx/*'
            // ,ext: 'jpg|png|gif|bmp|jpeg'
            , multiple: true
            , auto: false
            , bindAction: '#testListAction1'
            , choose: function (obj) {
                var files = this.files = obj.pushFile(); //将每次选择的文件追加到文件队列
                obj.preview(function (index, file, result) {
                    var tr = $(['<tr id="upload-' + index + '">'
                        , '<td>' + file.name + '</td>'
                        , '<td>' + (file.size / 1014).toFixed(1) + 'kb</td>'
                        , '<td>等待上传</td>'
                        , '<td>'
                        , '<button class="layui-btn layui-btn-xs demo-reload layui-hide">' + '重传</button>'
                        , '<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
                        , '</td>'
                        , '</tr>'].join(''));
                    //单个重传
                    tr.find('.demo-reload').on('click', function () {
                        obj.upload(index, file);
                    });
                    //删除
                    tr.find('.demo-delete').on('click', function () {
                        delete files[index]; //删除对应的文件
                        tr.remove();
                        uploadListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
                    });
                    //预览
                    demoListView.append(tr);
                });
            }
            , done: function (res, index, upload) {
                if (res.code == 200) { //上传成功
                    var tr = demoListView.find('tr#upload-' + index)
                        , tds = tr.children();
                    tds.eq(2).html('<span style="color: #5FB878;">上传成功</span>');
                    tds.eq(2).attr('returnUrl', res.data.url)
                    tds.eq(3).html(''); //清空操作
                    return delete this.files[index]; //删除文件队列已经上传成功的文件
                }
                this.error(index, upload);
            }
            , allDone: function (obj) { //当文件全部被提交后，才触发
                layer.msg('保存成功！', {
                    time: 2000, //2s后自动关闭
                    btn: ['确定']
                });
                // location.href = "/inputBill/index";
            }
            , error: function (index, upload) {
                var tr = demoListView.find('tr#upload-' + index)
                    , tds = tr.children();
                tds.eq(1).html('<span style="color: #FF5722;">上传失败</span>');
                tds.eq(2).find('.demo-reload').removeClass('layui-hide'); //显示重传
            }
        });
    });
    //绑定上传触发器
    $("#upload").click(function () {
        $("#testListAction1").trigger("click");  //触发上传文件
    })


</script>

</html>
